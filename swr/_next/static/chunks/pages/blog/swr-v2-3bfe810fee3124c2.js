(self.webpackChunk_N_E = self.webpackChunk_N_E || []).push([[191], { 5952: function (s, e, n) { (window.__NEXT_P = window.__NEXT_P || []).push(["/blog/swr-v2.html", function () { return n(1624) }]) }, 1624: function (s, e, n) { "use strict"; n.r(e), n.d(e, { __toc: function () { return h }, default: function () { return x } }); var l = n(2676), r = n(3017), i = n(6952), o = { src: "/_next/static/media/cache-view.0fce1a0b.jpg", height: 605, width: 1497, blurDataURL: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAMACAMBIgACEQEDEQH/xAAoAAEBAAAAAAAAAAAAAAAAAAAABwEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAJ+Gf//EABkQAAMAAwAAAAAAAAAAAAAAAAECAwARMf/aAAgBAQABPwBrVJbbdz//xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oACAECAQE/AH//xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oACAEDAQE/AH//2Q==", blurWidth: 8, blurHeight: 3 }, t = n(4894), c = n(7591), a = n(1621); let h = [{ depth: 2, value: "数据更改和乐观 UI", id: "mutation-and-optimistic-ui" }, { depth: 3, value: "useSWRMutation", id: "useswrmutation" }, { depth: 3, value: "乐观 UI", id: "optimistic-ui" }, { depth: 3, value: "多个 key 数据更改", id: "mutate-multiple-keys" }, { depth: 2, value: "SWR 开发者工具", id: "swr-devtools" }, { depth: 2, value: "预加载数据", id: "preloading-data" }, { depth: 2, value: "isLoading", id: "isloading" }, { depth: 2, value: "保存以前的状态", id: "preserving-previous-state" }, { depth: 2, value: "扩展配置", id: "extending-configurations" }, { depth: 2, value: "优化了对 React 18 的支持", id: "improved-react-18-support" }, { depth: 2, value: "迁移指南", id: "migration-guide" }, { depth: 3, value: "Fetcher 不再接受多个参数", id: "fetcher-no-longer-accepts-multiple-arguments" }, { depth: 3, value: "全局数据更改不再接受 getKey 函数", id: "global-mutate-no-longer-accepts-a-getkey-function" }, { depth: 3, value: "Cache Interface 新增必选属性 keys()", id: "new-required-property-keys-for-cache-interface" }, { depth: 3, value: "改变了缓存的内部结构", id: "changed-cache-internal-structure" }, { depth: 3, value: "SWRConfig.default 重命名为 SWRConfig.defaultValue", id: "swrconfigdefault-is-renamed-as-swrconfigdefaultvalue" }, { depth: 3, value: "Type InfiniteFetcher 重命名为 SWRInfiniteFetcher", id: "type-infinitefetcher-is-renamed-as-swrinfinitefetcher" }, { depth: 3, value: "避免在服务端使用 Suspense", id: "avoid-suspense-on-server" }, { depth: 3, value: "以 ES2018 为构建目标", id: "es2018-as-the-build-target" }, { depth: 2, value: "更新日志", id: "changelog" }, { depth: 2, value: "展望未来 & 致谢！", id: "the-future--thank-you" }]; function d (s) { let e = Object.assign({ h1: "h1", p: "p", h2: "h2", h3: "h3", code: "code", pre: "pre", span: "span", ul: "ul", li: "li", a: "a", img: "img", strong: "strong", em: "em" }, (0, i.a)(), s.components); return (0, l.jsxs)(l.Fragment, { children: [(0, l.jsx)(e.h1, { id: "announcing-swr-20", children: "SWR 2.0 发布" }), "\n", (0, l.jsxs)(c.Z, { date: "December 9th, 2022", children: [(0, l.jsx)(c.S, { name: "Shu Ding", link: "https://twitter.com/shuding_" }), (0, l.jsx)(c.S, { name: "Jiachi Liu", link: "https://twitter.com/huozhi" }), (0, l.jsx)(c.S, { name: "Toru Kobayashi", link: "https://twitter.com/koba04" }), (0, l.jsx)(c.S, { name: "Yixuan Xu", link: "https://twitter.com/yixuanxu94" })] }), "\n", (0, l.jsx)(e.p, { children: "我们很高兴宣布 SWR 2.0 的发布，SWR 是一款主流的 React 数据请求库，它使组件能够获取、缓存及更改数据，并使 UI 能随时间变化保持最新的数据。" }), "\n", (0, l.jsx)(e.p, { children: "在新版本中包含了很多优化和新功能，例如新的数据更改 API、经过优化的乐观 UI 功能、新的 DevTools、以及对并发渲染的更好支持。衷心感谢所有使这个版本成为可能的贡献者和维护者。" }), "\n", (0, l.jsx)(e.h2, { id: "mutation-and-optimistic-ui", children: "数据更改和乐观 UI" }), "\n", (0, l.jsx)(e.h3, { id: "useswrmutation", children: "useSWRMutation" }), "\n", (0, l.jsxs)(e.p, { children: ["数据更改（Mutation）是数据请求过程中非常重要的一部分，它使你可以修改本地或者远程的数据。我们目前使用的 ", (0, l.jsx)(e.code, { children: "mutate" }), " API 允许你手动重新验证或更新资源。在 SWR 2.0 中，新的 hook ", (0, l.jsx)(e.code, { children: "useSWRMutation" }), " 使用了声明式的 API ，使更改远程数据更加简单。你可以使用 hook 设置一个数据更改，并在随后触发它。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " useSWRMutation " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr/mutation'" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "async" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "sendRequest" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(url" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { arg }) {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "fetch" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(url" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    method" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'POST'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    body" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "JSON" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".stringify" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(arg)" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "App" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "() {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "trigger" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "isMutating" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWRMutation" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/user'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " sendRequest)" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "disabled" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{isMutating}" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{() " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "trigger" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "({ username" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'johndoe'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " })}" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    >{" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      isMutating " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "?" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'Creating...'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'Create User'" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    }</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  )" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["上面的例子中定义了一个影响 ", (0, l.jsx)(e.code, { children: "/api/user" }), " 资源的 ", (0, l.jsx)(e.code, { children: "sendRequest" }), " 数据更改。与 ", (0, l.jsx)(e.code, { children: "useSWR" }), " 不同，", (0, l.jsx)(e.code, { children: "useSWRMutation" }), " 并不会在渲染时立即发送请求，而是会返回一个 ", (0, l.jsx)(e.code, { children: "trigger" }), " 函数，之后你可以手动调用该函数触发数据更改。"] }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "sendRequest" }), " 函数会在按钮被点击时触发，并传入额外的参数 ", (0, l.jsx)(e.code, { children: "{ username: 'johndoe' }" }), "。", (0, l.jsx)(e.code, { children: "isMutating" }), " 的值会被设置为 ", (0, l.jsx)(e.code, { children: "true" }), " 直到数据更改的请求完成。"] }), "\n", (0, l.jsx)(e.p, { children: "此外，这个新的 hook 还解决了数据更改可能带来的其他问题:" }), "\n", (0, l.jsxs)(e.ul, { children: ["\n", (0, l.jsx)(e.li, { children: "当数据发生变化时，乐观地更新 UI" }), "\n", (0, l.jsx)(e.li, { children: "在数据更改失败时自动回滚" }), "\n", (0, l.jsxs)(e.li, { children: ["避免了 ", (0, l.jsx)(e.code, { children: "useSWR" }), " 和同一资源的其他数据更改之间任何潜在的竞态条件。"] }), "\n", (0, l.jsxs)(e.li, { children: ["数据更改完成后，填充 ", (0, l.jsx)(e.code, { children: "useSWR" }), " 缓存。"] }), "\n", (0, l.jsx)(e.li, { children: "..." }), "\n"] }), "\n", (0, l.jsxs)(e.p, { children: ["通过阅读 ", (0, l.jsx)(e.a, { href: "/docs/mutation#useswrmutation.html", children: "文档" }), " 或阅读接下来的几节，你可以找到更加深入的 API 参考和示例。"] }), "\n", (0, l.jsx)(e.h3, { id: "optimistic-ui", children: "乐观 UI" }), "\n", (0, l.jsx)(e.p, { children: "乐观 UI 是一种优秀的模型，用于创建让人感觉快速和敏捷的网站；然而，它可能很难正确的去实现。SWR 2.0 增加了一些强大的新选项，使乐观 UI 的实现更加容易。" }), "\n", (0, l.jsx)(e.p, { children: "假设我们有一个 API 用于添加一个新的待办事项到待办列表中，并将它发送到服务端：" }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsx)(e.code, { "data-language": "jsx", "data-theme": "default", children: (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "await" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }) }) }), "\n", (0, l.jsxs)(e.p, { children: ["在我们的 UI 中，我们使用 ", (0, l.jsx)(e.code, { children: "useSWR" }), ' 这个 hook 去展示待办列表，其中的 "Add New Item" 按钮用于触发这个请求并要求 SWR 通过 ', (0, l.jsx)(e.code, { children: "mutate()" }), " 重新获取数据："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/todos'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "/* 展示数据 */" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "async" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "await" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  }}>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    Add New Item" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  </" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</>" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["然而，", (0, l.jsx)(e.code, { children: "await addNewTodo(...)" }), " 请求可能会特别慢。当它正在请求时，用户看到仍然是旧的列表，即使我们已经知道新的列表会是什么样子。有了新的 ", (0, l.jsx)(e.code, { children: "optimisticData" }), " 选项，我们可以在服务端响应之前，乐观地展示新的列表："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/todos'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "/* 展示数据 */" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{() " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      optimisticData" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " [" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "..." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "]" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  }}>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    Add New Item" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  </" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</>" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["SWR 将立即用 ", (0, l.jsx)(e.code, { children: "optimisticData" }), " 值去更新 ", (0, l.jsx)(e.code, { children: "data" }), "，然后将请求发送到服务端。一旦请求完成，SWR 将重新验证该资源以确保它是最新的。"] }), "\n", (0, l.jsxs)(e.p, { children: ["像许多 API 一样，如果 ", (0, l.jsx)(e.code, { children: "addNewTodo(...)" }), " 请求会从服务端返回最新的数据，我们也可以直接显示这个结果（而不是开始一个新的重新验证）! 还有一个新的 ", (0, l.jsx)(e.code, { children: "populateCache" }), " 选项，告诉 SWR 用 mutate 的响应去更新本地数据："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/todos'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "/* 展示数据 */" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{() " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      optimisticData" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " [" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "..." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "]" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      populateCache" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "true" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  }}>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    Add New Item" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  </" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</>" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["同时，我们不需要在请求后进行重新验证了，因为响应的数据来自真实的数据源，我们可以使用 ", (0, l.jsx)(e.code, { children: "revalidate" }), " 选项禁用它："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/todos'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "/* 展示数据 */" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{() " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      optimisticData" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " [" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "..." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "]" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      populateCache" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "true" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      revalidate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "false" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  }}>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    Add New Item" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  </" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</>" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["最后，如果 ", (0, l.jsx)(e.code, { children: "addNewTodo(...)" }), " 因为意外情况失败了，我们可以通过将 ", (0, l.jsx)(e.code, { children: "rollbackOnError" }), " 设置为 ", (0, l.jsx)(e.code, { children: "true" }), "（该选项默认开启）以回滚刚刚设置的乐观数据（", (0, l.jsx)(e.code, { children: "[...data, 'New Item']" }), "）。一旦出现这种情况，SWR 会将 ", (0, l.jsx)(e.code, { children: "data" }), " 回滚为上一次的值："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/todos'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "/* 展示数据 */" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "ul" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onClick" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{() " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "addNewTodo" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      optimisticData" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " [" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "..." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'New Item'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "]" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      populateCache" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "true" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      revalidate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "false" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      rollbackOnError" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "true" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  }}>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    Add New Item" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  </" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "button" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</>" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["所有 API 都在新的 ", (0, l.jsx)(e.code, { children: "useSWRMutationhook" }), " hook 中得到支持。想要了解更多关于它们的信息，你可以查看我们的 ", (0, l.jsx)(e.a, { href: "https://swr.vercel.app/docs/mutation#optimistic-updates.html", children: "文档" }), "，这里有一个 demo 用于演示这种行为:"] }), "\n", (0, l.jsx)(a.Z, { src: "/video/optimistic-ui.mp4", caption: "能自动错误回滚的乐观用户 UI", ratio: 223 / 584 }), "\n", (0, l.jsx)(e.h3, { id: "mutate-multiple-keys", children: "多个 key 数据更改" }), "\n", (0, l.jsxs)(e.p, { children: ["全局 ", (0, l.jsx)(e.code, { children: "mutate" }), " API 现在接受一个 ", (0, l.jsx)(e.code, { children: "filter" }), " 函数，您可以在其中进行特定 key 的数据更改或重新验证。这对于”使所有缓存的数据失效”之类的用例非常有帮助。要了解更多信息，可以阅读文档中的 ", (0, l.jsx)(e.a, { href: "/docs/mutation#%E6%9B%B4%E6%94%B9%E5%A4%9A%E9%A1%B9%E6%95%B0%E6%8D%AE.html", children: "更改多项数据" }), "。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { mutate } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr'" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// 或者从 hook 获取，如果你自定义了你的缓存 provider：" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// { mutate } = useSWRConfig()" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// 单数据源数据更改" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key)" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// 更改多个数据源数据并清除缓存（设置为 undefined）" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "mutate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  key " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "typeof" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " key " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "===" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'string'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "&&" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "key" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".startsWith" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/item?id='" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "undefined" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  { revalidate" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "false" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " }" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ")" }) })] }) }), "\n", (0, l.jsx)(e.h2, { id: "swr-devtools", children: "SWR 开发者工具" }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.a, { href: "https://swr-devtools.vercel.app", children: "SWRDevTools" }), " 是一个用于帮助你调试你的 SWR 缓存及请求结果的浏览器拓展程序。请查看我们的 ", (0, l.jsx)(e.a, { href: "/docs/advanced/devtools.html", children: "devtools" }), " 查结，了解如何在你的应用程序中使用 devtools。"] }), "\n", (0, l.jsx)(e.p, { children: (0, l.jsx)(e.img, { placeholder: "blur", src: o }) }), "\n", (0, l.jsx)(e.h2, { id: "preloading-data", children: "预加载数据" }), "\n", (0, l.jsxs)(e.p, { children: ["预加载数据可以极大地改善用户体验。如果你知道某个资源稍后将在应用程序被使用，那么你可以使用新的 ", (0, l.jsx)(e.code, { children: "preload" }), " API 提前开始请求它："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { preload } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr'" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "fetcher" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (url) " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "fetch" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(url)" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".then" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "((res) " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "res" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".json" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "())" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// 你可以在任意位置调用 preload 函数" }) }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "preload" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/user'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " fetcher)" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Profile" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "() {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// 实际使用数据的组件：" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "error" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/user'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " fetcher)" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-comment)" }, children: "// ..." })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "export" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Page" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "Profile" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "/>" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["在这个例子中， ", (0, l.jsx)(e.code, { children: "preload" }), " API 在全局作用域中被调用。这意味着我们在 React 开始渲染之前就开始预加载资源。\n当 ", (0, l.jsx)(e.code, { children: "Profile" }), " 组件被渲染时，数据可能已经可用。如果它还在进行中，", (0, l.jsx)(e.code, { children: "useSWR" }), " 钩子将复用那个正在进行的预加载请求，而不是启动一个新的请求。"] }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "preload" }), " API 也可以用在为另一个可能被渲染的页面预加载数据的情况。关于使用 SWR 预取数据的更多信息可以在", (0, l.jsx)(e.a, { href: "/docs/refetching.html", children: "这里" }), "找到。"] }), "\n", (0, l.jsx)(e.h2, { id: "isloading", children: (0, l.jsx)(e.code, { children: "isLoading" }) }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "isLoading" }), " 是 ", (0, l.jsx)(e.code, { children: "useSWR" }), " 返回的一个新的状态，它表示", (0, l.jsx)(e.strong, { children: "请求仍在进行中，并且还没有加载数据" }), "。在之前，", (0, l.jsx)(e.code, { children: "isValidating" }), " 状态同时代表初始加载状态和重新验证状态，所以我们必须检查 ", (0, l.jsx)(e.code, { children: "data" }), " 和 ", (0, l.jsx)(e.code, { children: "error" }), " 是否都为 ", (0, l.jsx)(e.code, { children: "undefined" }), "，以确定它是否为初始加载状态。"] }), "\n", (0, l.jsxs)(e.p, { children: ["现在，你可以直接使用 ", (0, l.jsx)(e.code, { children: "isLoading" }), " 的值来渲染一个加载信息。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " useSWR " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr'" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Profile" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "() {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "isLoading" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'/api/user'" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " fetcher)" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "if" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (isLoading) " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">loading...</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">hello {" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".name}!</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, l.jsxs)(e.p, { children: ["注意 ", (0, l.jsx)(e.code, { children: "isValidating" }), " 仍然存在，所以你依然可以用它来显示重新验证的加载指示器。"] }), "\n", (0, l.jsx)(t.UW, { emoji: "\uD83D\uDCDD", children: (0, l.jsxs)(e.p, { children: ["我们增加了新的 ", (0, l.jsx)(e.a, { href: "/docs/advanced/understanding.html", children: "理解 SWR" }), " 页面来描述 SWR 如何返回值，其中包括 ", (0, l.jsx)(e.code, { children: "isValidating" }), " 和 ", (0, l.jsx)(e.code, { children: "isLoading" }), " 的区别，以及如何结合它们来改善用户体验。"] }) }), "\n", (0, l.jsx)(e.h2, { id: "preserving-previous-state", children: "保存以前的状态" }), "\n", (0, l.jsxs)(e.p, { children: ["新增加了 ", (0, l.jsx)(e.code, { children: "keepPreviousData" }), " 选项，它允许你保留之前获取的数据。当你根据实时的用户操作获取数据时可以极大地改善用户体验。例如在实时搜索功能中，资源的 `key' 会不断变化："] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Search" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "() {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " [" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "search" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "setSearch" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "] " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "React" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".useState" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "''" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ");" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "isLoading" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWR" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "`/search?q=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "${" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "search" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "}" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "`" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " fetcher" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, l.jsxs)(e.span, { className: "line highlighted", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    keepPreviousData" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "true" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "input" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "        " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "type" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: '"text"' })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "        " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "value" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{search}" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "        " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "onChange" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{(e) " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "setSearch" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "e" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "target" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".value)}" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "        " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "placeholder" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: '"Search..."' })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      />" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "className" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{isLoading " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "?" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: '"loading"' }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: '""' }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}>" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "        {" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "?." }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "products" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".map" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(item " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "Product" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "key" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "item" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".id} " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "name" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "item" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".name} />)" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ">" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "div" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ">" })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  );" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, l.jsx)(a.Z, { src: "https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4", caption: "当开启 keepPreviousData 将会保留之前的搜索结果", ratio: 640 / 730 }), "\n", (0, l.jsxs)(e.p, { children: ["你可以在 ", (0, l.jsx)(e.a, { href: "https://codesandbox.io/s/swr-keeppreviousdata-fsjz3m", children: "CodeSandbox" }), " 上查看完整代码，在", (0, l.jsx)(e.a, { href: "/docs/advanced/understanding#%E8%BF%94%E5%9B%9E%E4%B9%8B%E5%89%8D%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BB%A5%E8%8E%B7%E5%BE%97%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C.html", children: "这里" }), "了解更多信息。"] }), "\n", (0, l.jsx)(e.h2, { id: "extending-configurations", children: "扩展配置" }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "SWRConfig" }), " 现在可以接受一个函数值。当你有多级的 ", (0, l.jsx)(e.code, { children: "<SWRConfig>" }), " 时，内部会接收父级配置并返回一个新的配置。这一变化使得在大型代码库中配置 SWR 更加灵活。更多信息可以在", (0, l.jsx)(e.a, { href: "/docs/global-configuration.html", children: "这里" }), "找到。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "jsx", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "jsx", "data-theme": "default", children: [(0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "<" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "SWRConfig" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "value" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "{parentConfig " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " ({" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    dedupingInterval" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "parentConfig" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".dedupingInterval " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "*" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "5" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    refreshInterval" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "100" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  })}" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" }) }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  <" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "Page" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " />" })] }), "\n", (0, l.jsxs)(e.span, { className: "line", children: [(0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "</" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "SWRConfig" }), (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] })] }) }), "\n", (0, l.jsx)(e.h2, { id: "improved-react-18-support", children: "优化了对 React 18 的支持" }), "\n", (0, l.jsxs)(e.p, { children: ["SWR 已经更新了其内部代码，以便在 React 18 中使用 ", (0, l.jsx)(e.code, { children: "useSyncExternalStore" }), " 和 ", (0, l.jsx)(e.code, { children: "startTransition" }), " 这两个 API。这确保了在并发渲染 UI 时的强一致性。这一变化不需要修改任何用户代码，所有开发者都可以直接受益。"] }), "\n", (0, l.jsx)(e.p, { children: "SWR 2.0 所有的新功能仍然可以与 React 16 和 17 兼容。" }), "\n", (0, l.jsx)(e.h2, { id: "migration-guide", children: "迁移指南" }), "\n", (0, l.jsx)(e.h3, { id: "fetcher-no-longer-accepts-multiple-arguments", children: "Fetcher 不再接受多个参数" }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "key" }), " 现在作为一个单独的参数传递"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- useSWR([1, 2, 3], (a, b, c) => {" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ useSWR([1, 2, 3], ([a, b, c]) => {" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  assert(a === 1)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  assert(b === 2)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  assert(c === 3)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "})" }) })] }) }), "\n", (0, l.jsxs)(e.h3, { id: "global-mutate-no-longer-accepts-a-getkey-function", children: ["全局数据更改不再接受 ", (0, l.jsx)(e.code, { children: "getKey" }), " 函数"] }), "\n", (0, l.jsxs)(e.p, { children: ["在之前，你可以向全局的 ", (0, l.jsx)(e.code, { children: "mutate" }), " 传递一个返回 key 的函数。而现在，如果你向全局 ", (0, l.jsx)(e.code, { children: "mutate" }), " 传入一个函数，它会被当作一个", (0, l.jsx)(e.a, { href: "/blog/swr-v2#%E5%A4%9A%E4%B8%AAkey%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%94%B9.html", children: "过滤函数" }), "。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- mutate(() => '/api/item') // 一个返回 key 的函数" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ mutate('/api/item')       // 直接传入 key 以更改数据" }) })] }) }), "\n", (0, l.jsxs)(e.h3, { id: "new-required-property-keys-for-cache-interface", children: ["Cache Interface 新增必选属性 ", (0, l.jsx)(e.code, { children: "keys()" })] }), "\n", (0, l.jsxs)(e.p, { children: ["当你使用自己的缓存实现时，Cache 接口新增了一个 ", (0, l.jsx)(e.code, { children: "keys()" }), " 方法来返回缓存对象中的所有 key，类似于 JavaScript 的 Map 实例。"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "interface Cache<Data> {" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  get(key: string): Data | undefined" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  set(key: string, value: Data): void" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  delete(key: string): void" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ keys(): IterableIterator<string>" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, l.jsx)(e.h3, { id: "changed-cache-internal-structure", children: "改变了缓存的内部结构" }), "\n", (0, l.jsx)(e.p, { children: "缓存数据的内部结构将变为一个持有所有当前状态的对象。" }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- assert(cache.get(key) === data)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ assert(cache.get(key) === { data, error, isValidating })" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "// getter" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- cache.get(key)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ cache.get(key)?.data" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: " " }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "// setter" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- cache.set(key, data)" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ cache.set(key, { ...cache.get(key), data })" }) })] }) }), "\n", (0, l.jsx)(t.UW, { emoji: "\uD83D\uDEA8", type: "error", children: (0, l.jsx)(e.p, { children: "你不应该直接写入缓存，这可能会导致未定义行为。" }) }), "\n", (0, l.jsxs)(e.h3, { id: "swrconfigdefault-is-renamed-as-swrconfigdefaultvalue", children: [(0, l.jsx)(e.code, { children: "SWRConfig.default" }), " 重命名为 ", (0, l.jsx)(e.code, { children: "SWRConfig.defaultValue" })] }), "\n", (0, l.jsxs)(e.p, { children: [(0, l.jsx)(e.code, { children: "SWRConfig.defaultValue" }), " 是一个用于获取默认 SWR 配置的属性"] }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- SWRConfig.default" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ SWRConfig.defaultValue" }) })] }) }), "\n", (0, l.jsxs)(e.h3, { id: "type-infinitefetcher-is-renamed-as-swrinfinitefetcher", children: ["Type ", (0, l.jsx)(e.code, { children: "InfiniteFetcher" }), " 重命名为 ", (0, l.jsx)(e.code, { children: "SWRInfiniteFetcher" })] }), "\n", (0, l.jsx)(e.pre, { "data-language": "diff", "data-theme": "default", hasCopyCode: !0, children: (0, l.jsxs)(e.code, { "data-language": "diff", "data-theme": "default", children: [(0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#EF6270" }, children: "- import type { InfiniteFetcher } from 'swr/infinite'" }) }), "\n", (0, l.jsx)(e.span, { className: "line", children: (0, l.jsx)(e.span, { style: { color: "#4BB74A" }, children: "+ import type { SWRInfiniteFetcher } from 'swr/infinite'" }) })] }) }), "\n", (0, l.jsx)(e.h3, { id: "avoid-suspense-on-server", children: "避免在服务端使用 Suspense" }), "\n", (0, l.jsxs)(e.p, { children: ["如果你想要在服务端使用 SWR ", (0, l.jsx)(e.code, { children: "suspense: true" }), "，包括 Next.js 的预渲染，那么你必须通过 ", (0, l.jsxs)(e.a, { href: "/docs/with-nextjs#pre-rendering-with-default-data.html", children: [(0, l.jsx)(e.code, { children: "fallbackData" }), " 或 ", (0, l.jsx)(e.code, { children: "fallback" })] }), " 提供初始数据。今天这意味着你不能在服务端使用 Susense 获取数据了。你的另外两种选则是完全在客户端获取数据，或者使用框架获取数据(就像 Next.js 中的 getStaticProps 那样)。"] }), "\n", (0, l.jsx)(e.h3, { id: "es2018-as-the-build-target", children: "以 ES2018 为构建目标" }), "\n", (0, l.jsx)(e.p, { children: "如果你想支持 IE 11，你必须在你的框架或 bundler 指定构建目标为 ES5。这一变化使 SSR 的性能得到了优化，并使构建产物的体积变小。" }), "\n", (0, l.jsx)(e.h2, { id: "changelog", children: "更新日志" }), "\n", (0, l.jsxs)(e.p, { children: ["在 ", (0, l.jsx)(e.a, { href: "https://github.com/vercel/swr/releases", children: "GitHub" }), " 查看完整日志。"] }), "\n", (0, l.jsx)(e.h2, { id: "the-future--thank-you", children: "展望未来 & 致谢！" }), "\n", (0, l.jsxs)(e.p, { children: ["随着 ", (0, l.jsx)(e.a, { href: "https://nextjs.org/blog/next-13.html", children: "Next.js 13" }), " 的新发布 ，我们看到了很多令人兴奋的新特性和 React 生态系统中的范式转变：", (0, l.jsx)(e.a, { href: "https://beta.nextjs.org/docs/rendering/server-and-client-components.html", children: "React Server Components" }), "，streaming SSR，", (0, l.jsx)(e.a, { href: "https://beta.nextjs.org/docs/data-fetching/fetching#asyncawait-in-server-components.html", children: "async components" }), "，以及 ", (0, l.jsxs)(e.a, { href: "https://github.com/acdlite/rfcs/blob/first-class-promises/text/0000-first-class-support-for-promises.md#usepromise", children: [(0, l.jsx)(e.code, { children: "use" }), " hook"] }), " 。其中许多都与数据获取有关，有一部分与 SWR 有着相同的使用场景。"] }), "\n", (0, l.jsxs)(e.p, { children: ["然而 SWR 项目的目标仍然不变。我们希望它成为一个轻量级的、框架无关的、有一点 ", (0, l.jsx)(e.em, { children: "固执" }), "（例如：聚焦时重新验证）的落地库。我们不想成为一个标准的解决方案，而是想专注于创新，使用户体验变得更好。同时我们也在研究如何利用 React 的这些新能力来改进 SWR。"] }), "\n", (0, l.jsxs)(e.p, { children: ["我们要感谢 ", (0, l.jsx)(e.a, { href: "https://github.com/vercel/swr/graphs/contributors", children: "143" }), " 贡献者（+", (0, l.jsx)(e.a, { href: "https://github.com/vercel/swr-site/graphs/contributors", children: "106" }), " 文档贡献者）中的每一位，以及那些给我们提供帮助或反馈的人。特别感谢 ", (0, l.jsx)(e.a, { href: "https://twitter.com/koba04", children: "Toru Kobayashi" }), " 在 DevTools 和文档方面所做的工作--没有你，我们不可能做到这一点!"] })] }) } var x = (0, r.j)({ MDXContent: function () { let s = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, { wrapper: e } = Object.assign({}, (0, i.a)(), s.components); return e ? (0, l.jsx)(e, { ...s, children: (0, l.jsx)(d, { ...s }) }) : d(s) }, pageOpts: { filePath: "pages/blog/swr-v2.mdx.html", route: "/blog/swr-v2.html", frontMatter: { image: "https://assets.vercel.com/image/upload/v1670542323/swr/v2.png", description: "SWR 2.0 发布：新的数据更改 API、经过优化的乐观 UI 功能、新的 DevTools、以及对并发渲染的更好支持，以及更多功能。", date: "December 9th, 2022" }, title: "SWR 2.0 发布", headings: h }, pageNextRoute: "/blog/swr-v2.html" }) }, 7591: function (s, e, n) { "use strict"; n.d(e, { S: function () { return i }, Z: function () { return r } }); var l = n(2676); function r (s) { let { date: e, children: n, by: r = "by" } = s; return (0, l.jsxs)("div", { className: "mt-4 mb-16 text-gray-500 text-sm", children: [e, " ", r, " ", n] }) } function i (s) { let { name: e, link: n } = s; return (0, l.jsx)("span", { className: "after:content-[','] last:after:content-['']", children: (0, l.jsx)("a", { href: n, target: "_blank", className: "mx-1 text-current underline [text-underline-position:from-font] decoration-from-font", children: e }, e) }) } }, 1621: function (s, e, n) { "use strict"; n.d(e, { Z: function () { return i } }); var l = n(2676), r = n(5271); function i (s) { let { id: e } = s, [n, i] = (0, r.useState)(!1); return (0, l.jsx)("div", { className: "my-4 overflow-hidden relative rounded-xl", children: (0, l.jsx)("iframe", { className: "w-full aspect-video", src: "https://www.youtube.com/embed/".concat(e), title: "YouTube video player", allow: "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture", onLoad: () => i(!0) }) }) } } }, function (s) { s.O(0, [17, 888, 774, 179], function () { return s(s.s = 5952) }), _N_E = s.O() }])