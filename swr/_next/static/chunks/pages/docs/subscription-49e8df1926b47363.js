(self.webpackChunk_N_E = self.webpackChunk_N_E || []).push([[288], { 279: function (s, e, r) { (window.__NEXT_P = window.__NEXT_P || []).push(["/docs/subscription.html", function () { return r(1567) }]) }, 1567: function (s, e, r) { "use strict"; r.r(e), r.d(e, { __toc: function () { return t } }); var o = r(2676), n = r(3017), l = r(6952), i = r(4894); let t = [{ depth: 2, value: "useSWRSubscription", id: "useswrsubscription" }, { depth: 3, value: "API", id: "api" }, { depth: 4, value: "参数", id: "parameters" }, { depth: 4, value: "返回值", id: "return-values" }, { depth: 3, value: "基本用法", id: "usage" }, { depth: 3, value: "去重", id: "deduplication" }]; function c (s) { let e = Object.assign({ h1: "h1", p: "p", h2: "h2", code: "code", pre: "pre", span: "span", h3: "h3", h4: "h4", ul: "ul", li: "li", a: "a" }, (0, l.a)(), s.components); return (0, o.jsxs)(o.Fragment, { children: [(0, o.jsx)(e.h1, { children: "订阅" }), "\n", (0, o.jsx)(i.UW, { emoji: "✅", children: (0, o.jsx)(e.p, { children: "请升级到最新版本 (≥ 2.1.0) 来使用这个 API." }) }), "\n", (0, o.jsx)(e.h2, { id: "useswrsubscription", children: (0, o.jsx)(e.code, { children: "useSWRSubscription" }) }), "\n", (0, o.jsxs)(e.p, { children: [(0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 是一个使用 SWR 订阅实时数据源的 React Hook。"] }), "\n", (0, o.jsx)(e.pre, { "data-language": "tsx", "data-theme": "default", hasCopyCode: !0, children: (0, o.jsx)(e.code, { "data-language": "tsx", "data-theme": "default", children: (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWRSubscription" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "<" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Error" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">(key: Key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " subscribe: (key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " options" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (error" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "?:" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Error" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "|" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "null" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ") " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "void" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " }) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "void" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "): { data?" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " Data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " error?" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: ":" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " Error }" })] }) }) }), "\n", (0, o.jsx)(e.h3, { id: "api", children: "API" }), "\n", (0, o.jsx)(e.p, { children: "这个 hook 使用提供的 subscribe 函数订阅实时数据源，并返回接收到的最新数据和遇到的任何错误。当接收到新事件时，该 hook 会自动更新返回的数据。" }), "\n", (0, o.jsx)(e.h4, { id: "parameters", children: "参数" }), "\n", (0, o.jsxs)(e.ul, { children: ["\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "key" }), ": 这是一个用于标识所订阅数据的唯一 key 值, 与 ", (0, o.jsx)(e.code, { children: "useSWR" }), " key 参数的用法相同。"] }), "\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "subscribe" }), ": 这是一个用于订阅实时数据源的函数。它接收以下参数:", "\n", (0, o.jsxs)(e.ul, { children: ["\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "key" }), ": 与 ", (0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 的 key 参数相同。"] }), "\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "options" }), ": 一个带有以下属性的对象：", "\n", (0, o.jsxs)(e.ul, { children: ["\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "next" }), ": 一个函数，它接收一个错误和数据，然后使用从实时数据源接收到的最新数据来更新状态。"] }), "\n"] }), "\n"] }), "\n"] }), "\n"] }), "\n"] }), "\n", (0, o.jsx)(e.p, { children: "一个 subscribe 函数的例子" }), "\n", (0, o.jsx)(e.pre, { "data-language": "tsx", "data-theme": "default", hasCopyCode: !0, children: (0, o.jsxs)(e.code, { "data-language": "tsx", "data-theme": "default", children: [(0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "subscribe" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { next }) {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "sub" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "remote" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".subscribe" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (err" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " data) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(err" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " data))" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "sub" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".close" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, o.jsxs)(e.p, { children: ["你也可以给 ", (0, o.jsx)(e.code, { children: "next" }), " 函数的 ", (0, o.jsx)(e.code, { children: "data" }), " 参数一个函数，它接收上一次的数据作为第一个参数，然后返回一个新的数据。"] }), "\n", (0, o.jsx)(e.pre, { "data-language": "tsx", "data-theme": "default", hasCopyCode: !0, children: (0, o.jsxs)(e.code, { "data-language": "tsx", "data-theme": "default", children: [(0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "subscribe" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { next }) {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "sub" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "remote" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".subscribe" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (err" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " data) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(err" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " prev " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "prev" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".concat" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(data)))" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "sub" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".close" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, o.jsx)(e.h4, { id: "return-values", children: "返回值" }), "\n", (0, o.jsxs)(e.ul, { children: ["\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "state" }), ": 一个带有以下属性的对象:", "\n", (0, o.jsxs)(e.ul, { children: ["\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "data" }), ": 来自实时数据源的最新数据。"] }), "\n", (0, o.jsxs)(e.li, { children: [(0, o.jsx)(e.code, { children: "error" }), ": 如果在订阅实时数据源时发生错误，则为一个 ", (0, o.jsx)(e.code, { children: "Error" }), " 对象，否则为 ", (0, o.jsx)(e.code, { children: "undefined" }), " 。"] }), "\n"] }), "\n"] }), "\n"] }), "\n", (0, o.jsxs)(e.p, { children: ["当接收到新数据时，error 会被重置为 ", (0, o.jsx)(e.code, { children: "undefined" }), "。"] }), "\n", (0, o.jsx)(e.h3, { id: "usage", children: "基本用法" }), "\n", (0, o.jsxs)(e.p, { children: ["使用 ", (0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 订阅 Firestore 数据源的示例代码："] }), "\n", (0, o.jsx)(e.pre, { "data-language": "tsx", "data-theme": "default", hasCopyCode: !0, children: (0, o.jsxs)(e.code, { "data-language": "tsx", "data-theme": "default", children: [(0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " useSWRSubscription " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr/subscription'" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: " " }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "Post" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "({ id }) {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWRSubscription" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "([" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'views'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " id]" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " ([_" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " postId]" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { next }) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "ref" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "firebase" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".database" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".ref" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'views/'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "+" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " postId)" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "ref" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".on" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'value'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      snapshot " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "null" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "snapshot" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "())" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "      err " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(err)" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    )" }) }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "ref" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".off" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  })" }) }), "\n", (0, o.jsx)(e.span, { className: "line", children: " " }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "span" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">Your post has {data} views!</" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "span" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, o.jsxs)(e.p, { children: ["使用 ", (0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 订阅 WebSocket 数据源的示例代码："] }), "\n", (0, o.jsx)(e.pre, { "data-language": "tsx", "data-theme": "default", hasCopyCode: !0, children: (0, o.jsxs)(e.code, { "data-language": "tsx", "data-theme": "default", children: [(0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "import" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " useSWRSubscription " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "from" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'swr/subscription'" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: " " }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "function" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "App" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "() {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "data" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "error" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " } " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "useSWRSubscription" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'ws://...'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (key" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " { next }) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " {" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "const" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "socket" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "new" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "WebSocket" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(key)" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "socket" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".addEventListener" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'message'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (event) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "null" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "event" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".data))" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "socket" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".addEventListener" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "'error'" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-punctuation)" }, children: "," }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (event) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: "next" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "(" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "event" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ".error))" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "    " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " () " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "=>" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-constant)" }, children: "socket" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-function)" }, children: ".close" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "()" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  })" }) }), "\n", (0, o.jsx)(e.span, { className: "line", children: " " }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "if" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (error) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">failed to load</" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "if" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " (" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "!" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "data) " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">loading...</" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, o.jsxs)(e.span, { className: "line", children: [(0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "  " }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-keyword)" }, children: "return" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: " <" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">hello {data}!</" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-token-string-expression)" }, children: "div" }), (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: ">" })] }), "\n", (0, o.jsx)(e.span, { className: "line", children: (0, o.jsx)(e.span, { style: { color: "var(--shiki-color-text)" }, children: "}" }) })] }) }), "\n", (0, o.jsxs)(e.p, { children: ["你也可以在", (0, o.jsx)(e.a, { href: "/docs/typescript#.html", children: "这个页面" }), "查看 ", (0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 的 TypeScript 示例。"] }), "\n", (0, o.jsx)(e.h3, { id: "deduplication", children: "去重" }), "\n", (0, o.jsxs)(e.p, { children: [(0, o.jsx)(e.code, { children: "useSWRSubscription" }), " 会对具有相同 ", (0, o.jsx)(e.code, { children: "key" }), " 的订阅请求进行去重。如果有多个组件使用相同的键，它们将共享相同的订阅。当最后一个使用该键的组件卸载时，订阅将被关闭。"] }), "\n", (0, o.jsxs)(e.p, { children: ["这意味着如果您有多个使用相同键的组件，它们都将接收到相同的数据。并且每个 ", (0, o.jsx)(e.code, { children: "key" }), " 只有一个对实时数据源的订阅。"] })] }) } e.default = (0, n.j)({ MDXContent: function () { let s = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, { wrapper: e } = Object.assign({}, (0, l.a)(), s.components); return e ? (0, o.jsx)(e, { ...s, children: (0, o.jsx)(c, { ...s }) }) : c(s) }, pageOpts: { filePath: "pages/docs/subscription.mdx.html", route: "/docs/subscription.html", title: "订阅", headings: t }, pageNextRoute: "/docs/subscription.html" }) } }, function (s) { s.O(0, [17, 888, 774, 179], function () { return s(s.s = 279) }), _N_E = s.O() }])